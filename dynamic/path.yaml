http:
  routers:
    user-swagger: 
      rule: "Host(`localhost`) && (PathPrefix(`/users/swagger-ui`) || PathPrefix(`/users/v3/api-docs`))"
      entryPoints: [web]
      service: user-service
      priority: 100 
      middlewares: [common-strip-swagger] 

    user-api:
      rule: "Host(`localhost`) && PathPrefix(`/users`)"
      entryPoints: [web]
      service: user-service
      priority: 50
      middlewares: [jwt-auth]

    device-swagger:
      rule: "Host(`localhost`) && (PathPrefix(`/devices/swagger-ui`) || PathPrefix(`/devices/v3/api-docs`))"
      entryPoints: [web]
      service: device-service
      priority: 100
      middlewares: [common-strip-swagger] 

    device-api:
      rule: "Host(`localhost`) && PathPrefix(`/devices`)"
      entryPoints: [web]
      service: device-service
      priority: 50 
      middlewares: [jwt-auth]
    
    auth-swagger:
      rule: "Host(`localhost`) && (PathPrefix(`/auth/swagger-ui`) || PathPrefix(`/auth/v3/api-docs`))"
      entryPoints: [web]
      service: auth-service
      priority: 100 
      middlewares: [common-strip-swagger]

    auth-api-public:
      rule: "Host(`localhost`) && Path(`/auth/login`)"
      entryPoints: [web]
      service: auth-service
      priority: 11 

    auth-api-protected:
      rule: "Host(`localhost`) && PathPrefix(`/auth`)"
      entryPoints: [web]
      service: auth-service
      middlewares: [jwt-auth]
      priority: 10

    monitor-swagger:
      rule: "Host(`localhost`) && (PathPrefix(`/monitor/swagger-ui`) || PathPrefix(`/monitor/v3/api-docs`))"
      entryPoints: [web]
      service: monitor-service
      priority: 100 
      middlewares: [common-strip-swagger] 

    monitor-api:
      rule: "Host(`localhost`) && PathPrefix(`/monitor`)"
      entryPoints: [web]
      service: monitor-service
      priority: 50 
      middlewares: [jwt-auth]

  middlewares:
    common-strip-swagger:
      stripPrefix:
        prefixes:
          - "/users"
          - "/devices"
          - "/auth"
          - "/monitor"

    jwt-auth:
      plugin:
        jwtValidation:
          # SECRET - match with auth service
          secret: "supersecret123456supersecret123456" 
          signingMethod: "HS256"
          authHeader: true
          claims: "role"
          requiredClaim:
            role: ["ROLE_USER", "ROLE_ADMIN"]
          payloadHeaders:
            X-User: "sub"
            X-Role: "role"

  services:
    user-service:
      loadBalancer:
        servers:
          - url: "http://user-service:8080"    # container name + internal port
    device-service:
      loadBalancer:
        servers:
          - url: "http://device-service:8080" 
    auth-service:
      loadBalancer:
        servers:
          - url: "http://auth-service:8081"
    monitor-service:
      loadBalancer:
        servers:
          - url: "http://monitor-service:8080"
